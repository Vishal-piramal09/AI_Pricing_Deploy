<!DOCTYPE html>
<html lang="en">
<head>
    <base href="./">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approver Interface - Mobile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background-color: #f1f5f9;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        
        .container {
            width: 390px; /* iPhone 12/13 width */
            max-width: 100%;
            background-color: #f9fafb;
            height: 100%;
            min-height: 100vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            padding: 0;
        }
        
        .header {
            background-color: #1e40af;
            color: white;
            padding: 0.75rem 1rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .content-wrapper {
            padding: 0.5rem;
        }
        
        .section {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin: 0.5rem;
            overflow: hidden;
        }
        
        .section-header {
            padding: 0.3rem 0.5rem;
            background-color: #dbeafe;
            color: #1e40af;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            margin-left: 0.5rem;
            margin-right: 0.5rem;
        }
        
        .section-header i {
            margin-right: 0.5rem;
        }
        
        .section-body {
            padding: 0.5rem;
        }
        
        .nudge-layer {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }
        
        /* Approval Zone Styles */
        .approval-zone-bar {
            height: 40px;
            width: 100%;
            background: linear-gradient(to right, #ef4444 0%, #ef4444 30%, #9ca3af 30%, #9ca3af 75%, #10b981 75%, #10b981 100%);
            border-radius: 5px;
            position: relative;
            margin-bottom: 15px;
        }
        
        .approval-zone-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.75rem;
        }
        
        .approval-zone-label {
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.7rem;
        }
        
        .auto-reject {
            background-color: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fecaca;
        }
        
        .manual-review {
            background-color: #e5e7eb;
            color: #4b5563;
            border: 1px solid #d1d5db;
        }
        
        .auto-approve {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .approval-indicator {
            background-color: white;
            border: 2px solid #3b82f6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            position: absolute;
            bottom: -8px;
            transform: translateX(-50%);
        }
        
        .approval-status-card {
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-icon {
            font-size: 16px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .btn-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .scenario-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }
        
        .case-card {
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        .case-header {
            padding: 0.75rem 1rem;
            background-color: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .case-name {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .case-detail {
            font-size: 0.8rem;
            color: #6b7280;
        }
        
        .case-body {
            padding: 0.75rem 1rem;
        }
        
        .case-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .metric-item {
            font-size: 0.8rem;
        }
        
        .metric-value {
            font-weight: 600;
        }
        
        .negative {
            color: #dc2626;
        }
        
        .case-footer {
            padding: 0.75rem 1rem;
            background-color: #f8fafc;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pattern-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .pattern-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .badge-high {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .badge-medium {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .badge-low {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .metric-card {
            background-color: #f8fafc;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .metric-title {
            font-size: 0.7rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .metric-number {
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .metric-trend {
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }
        
        .trend-up {
            color: #dc2626;
        }
        
        .trend-down {
            color: #16a34a;
        }

        /* Case Navigation Styles */
        .case-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .case-item {
            display: none;
        }

        .case-item.active {
            display: block;
        }

        .case-pagination {
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2 class="m-0" style="font-size: 1.25rem; font-weight: 600;">Approver Dashboard</h2>
        <div class="small text-white-50">Deviation Approval Module</div>
    </div>
    
    <div class="content-wrapper">
        <!-- Scenario Selection -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-filter"></i> Select Scenario
            </div>
            <div class="section-body">
                <select class="form-select" id="scenario-selector">
                <option value="high-take-up-rate">High Take Up Rate - Priority Case</option>
                <option value="low-take-up-rate">Low Take Up Rate - Deprioritize</option>
                <option value="prime">Prime Customer - Conversion Critical</option>
                <option value="strategic">Strategic Relationship Case</option>
                <option value="micro">Micro-Deviation (Low Impact)</option>
                <option value="highrisk">High Risk Case</option>
                <option value="highticket">High Ticket Case</option>
                <option value="autoreject">Auto-Reject (High Risk Profile)</option>
                <option value="autoapprove">Auto-Approve (Micro-Deviation)</option>
                <option value="greyzone">Grey Zone (Manual Review)</option>
                </select>
            </div>
        </div>
        
        <!-- Portfolio Nudge Layer -->
        <div class="nudge-layer" id="portfolio-nudge">
            <h5><i class="fas fa-chart-line me-2"></i>Portfolio Alerts</h5>
            <p class="mb-2 small"><strong>Deviation trends requiring attention:</strong></p>
            <ul class="small mb-2">
                <li><strong>Yield Compression:</strong> -30 bps QoQ (12.05% → 11.85%)</li>
                <li><strong>High Deviation Rate:</strong> 35% vs 25% historical</li>
                <li><strong>Revenue Leakage:</strong> ₹15M MTD (+25% YoY)</li>
            </ul>
        </div>
        
        <!-- Primary Pattern Section -->
        <div class="section" id="primary-pattern-section">
            <div class="section-header">
                <i class="fas fa-robot"></i> <span id="pattern-name">Auto-detected Pattern</span>
            </div>
            <div class="section-body py-1">
                <div id="pattern-badge-container"></div>
                <div id="pattern-insight"></div>
            </div>
        </div>
        
        <!-- Hidden filter element (for JS functionality only) -->
        <select class="form-select d-none" id="approval-scenario">
            <option value="all" selected>All Cases</option>
            <option value="high">High Impact Cases</option>
            <option value="medium">Medium Impact Cases</option>
            <option value="low">Low Impact Cases</option>
            <option value="microdev">Micro-Deviation Cases</option>
            <option value="strategic">Strategic Relationship Cases</option>
            <option value="competitive">Competitive Offer Cases</option>
        </select>
        
        
        <!-- Pending Cases - One Case View with Navigation -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-list"></i> Current Case
            </div>
            <div class="section-body p-0">
                
                <!-- Case Container -->
                <div id="cases-container">
                    <!-- Case 1 -->
                    <div class="case-item active" data-case-index="1">
                        <div class="card mb-3 shadow-sm border-0" style="border-left: 4px solid #ef4444 !important;">
                            <div class="card-header py-2 px-3 d-flex justify-content-between align-items-center" style="background-color: #fef2f2; border-bottom: 1px solid #fee2e2;">
                                <div>
                                    <span class="badge bg-danger me-1">High Risk</span>
                                    <span class="badge bg-danger">High Impact</span>
                                </div>
                                <span style="font-size: 0.75rem; color: #6b7280;">2h ago</span>
                            </div>
                            
                            <div class="card-body p-3">
                                <div class="d-flex mb-2">
                                    <div style="width: 40px; height: 40px; border-radius: 20px; background-color: #fee2e2; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; color: #b91c1c;">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Rajendra Kumar</h6>
                                            <div>
                                                <span class="badge bg-primary">RM: Vikram S.</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 0.75rem; color: #6b7280;">CUST10045678 | Home Renovation Loan</div>
                                    </div>
                                </div>
                                
                                <!-- Case Details -->
                                <div class="row g-2 mb-2">
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">Amount</div>
                                        <div style="font-weight: 600;">₹25L</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">ROI</div>
                                        <div style="font-weight: 600; color: #b91c1c;">11.25%</div>
                                        <div style="font-size: 0.7rem; color: #ef4444;">-0.75%</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">PF</div>
                                        <div style="font-weight: 600; color: #b91c1c;">₹10K</div>
                                        <div style="font-size: 0.7rem; color: #ef4444;">-60%</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">Impact</div>
                                        <div style="font-weight: 600; color: #b91c1c;">₹1.2L</div>
                                    </div>
                                </div>
                                
                                <!-- RM Justification -->
                                <div class="mb-2 mt-1 p-2" style="background-color: #f9fafb; border-radius: 4px; border-left: 3px solid #d1d5db;">
                                    <div style="font-size: 0.7rem; font-weight: 600; color: #4b5563;">RM Justification:</div>
                                    <p style="font-size: 0.75rem; color: #4b5563; margin-bottom: 0;">
                                        "Customer has a competitive offer from ABC Bank at 11.00%. This is a high-value relationship customer with 3 existing products. The requested rate is needed to retain this relationship."
                                    </p>
                                </div>
                                
                                <!-- RM Performance Metrics -->
                                <div class="card mb-2 border-0 shadow-sm">
                                    <div class="card-header py-1 px-2 bg-light d-flex justify-content-between">
                                        <span style="font-size: 0.7rem; font-weight: 600; color: #4b5563;">RM Performance</span>
                                        <span class="badge bg-warning text-dark">Medium Risk RM</span>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="row g-1 mb-1">
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">Deviation Rate</div>
                                                <div style="font-weight: 600; color: #ef4444; font-size: 0.8rem;">32% <span style="font-size: 0.65rem;">(+7% vs avg)</span></div>
                                            </div>
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">S2D Rate</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">78% <span style="font-size: 0.65rem;">(+5% vs avg)</span></div>
                                            </div>
                                        </div>
                                        <div class="row g-1">
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">MTD Deviations</div>
                                                <div style="font-weight: 600; color: #ef4444; font-size: 0.8rem;">18 <span style="font-size: 0.65rem;">(+5 vs avg)</span></div>
                                            </div>
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">Avg Deviation Size</div>
                                                <div style="font-weight: 600; color: #ef4444; font-size: 0.8rem;">₹56K <span style="font-size: 0.65rem;">(+20% vs avg)</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                <!-- Approver's Incentive Impact with Recommendation -->
                                <div class="card mb-2 mt-3 border-0 shadow-sm bg-light">
                                    <div class="card-body p-2">
                                        <h6 class="mb-2" style="font-size: 0.8rem; font-weight: 600; color: #1e40af;">Approver's Incentive Impact</h6>
                                        <div class="d-flex justify-content-between mb-1" style="font-size: 0.8rem;">
                                            <span>Monthly incentive impact:</span>
                                            <span class="fw-bold text-danger">-₹2,150</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2" style="font-size: 0.8rem;">
                                            <span>Portfolio yield impact:</span>
                                            <span class="fw-bold text-danger">-3.2 bps</span>
                                        </div>
                                <div id="recommendation-container-1" class="recommendation-container">
                                    <!-- Recommendation content will be dynamically updated -->
                                </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center gap-2">
                                    <button class="btn btn-sm btn-success py-2 flex-fill">
                                        <i class="fas fa-check me-1"></i> Approve
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger py-2 flex-fill">
                                        <i class="fas fa-times me-1"></i> Reject
                                    </button>
                                    <div class="dropdown flex-fill">
                                        <button class="btn btn-sm btn-outline-primary dropdown-toggle w-100 py-2" type="button" id="discussionDropdown1" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="fas fa-comments me-1"></i> Discuss
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="discussionDropdown1">
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-user-tie me-2"></i>Contact RM</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Contact Customer</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-users me-2"></i>Schedule Call</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Case 2 -->
                    <div class="case-item" data-case-index="2">
                        <div class="card mb-3 shadow-sm border-0" style="border-left: 4px solid #f59e0b !important;">
                            <div class="card-header py-2 px-3 d-flex justify-content-between align-items-center" style="background-color: #fffbeb; border-bottom: 1px solid #fef3c7;">
                                <div>
                                    <span class="badge bg-warning text-dark me-1">Competitive</span>
                                    <span class="badge bg-success">Prime</span>
                                </div>
                                <span style="font-size: 0.75rem; color: #6b7280;">4h ago</span>
                            </div>
                            
                            <div class="card-body p-3">
                                <div class="d-flex mb-2">
                                    <div style="width: 40px; height: 40px; border-radius: 20px; background-color: #fef3c7; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; color: #92400e;">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Amit Verma</h6>
                                            <div>
                                                <span class="badge bg-success">RM: Anjali P.</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 0.75rem; color: #6b7280;">CUST10048792 | Business Expansion Loan</div>
                                    </div>
                                </div>
                                
                                <div class="row g-2 mb-2">
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">Amount</div>
                                        <div style="font-weight: 600;">₹15L</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">ROI</div>
                                        <div style="font-weight: 600; color: #92400e;">11.50%</div>
                                        <div style="font-size: 0.7rem; color: #f59e0b;">-0.50%</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">PF</div>
                                        <div style="font-weight: 600; color: #92400e;">₹15K</div>
                                        <div style="font-size: 0.7rem; color: #f59e0b;">-25%</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">Impact</div>
                                        <div style="font-weight: 600; color: #92400e;">₹65K</div>
                                    </div>
                                </div>
                                
                                <!-- RM Justification -->
                                <div class="mb-2 mt-1 p-2" style="background-color: #f9fafb; border-radius: 4px; border-left: 3px solid #d1d5db;">
                                    <div style="font-size: 0.7rem; font-weight: 600; color: #4b5563;">RM Justification:</div>
                                    <p style="font-size: 0.75rem; color: #4b5563; margin-bottom: 0;">
                                        "Business is expanding and customer needs quick disbursement. Has a competitive offer from XYZ Bank. Strong repayment history on previous loan."
                                    </p>
                                </div>
                                
                                <!-- RM Performance Metrics -->
                                <div class="card mb-2 border-0 shadow-sm">
                                    <div class="card-header py-1 px-2 bg-light d-flex justify-content-between">
                                        <span style="font-size: 0.7rem; font-weight: 600; color: #4b5563;">RM Performance</span>
                                        <span class="badge bg-success">Low Risk RM</span>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="row g-1 mb-1">
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">Deviation Rate</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">18% <span style="font-size: 0.65rem;">(-7% vs avg)</span></div>
                                            </div>
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">S2D Rate</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">92% <span style="font-size: 0.65rem;">(+19% vs avg)</span></div>
                                            </div>
                                        </div>
                                        <div class="row g-1">
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">MTD Deviations</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">9 <span style="font-size: 0.65rem;">(-4 vs avg)</span></div>
                                            </div>
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">Avg Deviation Size</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">₹28K <span style="font-size: 0.65rem;">(-35% vs avg)</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                <!-- Approver's Incentive Impact with Recommendation -->
                                <div class="card mb-2 mt-3 border-0 shadow-sm bg-light">
                                    <div class="card-body p-2">
                                        <h6 class="mb-2" style="font-size: 0.8rem; font-weight: 600; color: #1e40af;">Approver's Incentive Impact</h6>
                                        <div class="d-flex justify-content-between mb-1" style="font-size: 0.8rem;">
                                            <span>Monthly incentive impact:</span>
                                            <span class="fw-bold text-warning">-₹1,250</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2" style="font-size: 0.8rem;">
                                            <span>Portfolio yield impact:</span>
                                            <span class="fw-bold text-warning">-1.8 bps</span>
                                        </div>
                                <div id="recommendation-container-2" class="recommendation-container">
                                    <!-- Recommendation content will be dynamically updated -->
                                </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center gap-2">
                                    <button class="btn btn-sm btn-success py-2 flex-fill">
                                        <i class="fas fa-check me-1"></i> Approve
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger py-2 flex-fill">
                                        <i class="fas fa-times me-1"></i> Reject
                                    </button>
                                    <div class="dropdown flex-fill">
                                        <button class="btn btn-sm btn-outline-primary dropdown-toggle w-100 py-2" type="button" id="discussionDropdown2" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="fas fa-comments me-1"></i> Discuss
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="discussionDropdown2">
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-user-tie me-2"></i>Contact RM</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Contact Customer</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-users me-2"></i>Schedule Call</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Case 3 -->
                    <div class="case-item" data-case-index="3">
                        <div class="card mb-3 shadow-sm border-0" style="border-left: 4px solid #10b981 !important;">
                            <div class="card-header py-2 px-3 d-flex justify-content-between align-items-center" style="background-color: #ecfdf5; border-bottom: 1px solid #d1fae5;">
                                <div>
                                    <span class="badge bg-success me-1">Micro Dev</span>
                                    <span class="badge bg-success">Auto-Eligible</span>
                                </div>
                                <span style="font-size: 0.75rem; color: #6b7280;">5h ago</span>
                            </div>
                            
                            <div class="card-body p-3">
                                <div class="d-flex mb-2">
                                    <div style="width: 40px; height: 40px; border-radius: 20px; background-color: #d1fae5; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; color: #047857;">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Priya Sharma</h6>
                                            <div>
                                                <span class="badge bg-primary">RM: Rohit G.</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 0.75rem; color: #6b7280;">CUST10042155 | Personal Loan</div>
                                    </div>
                                </div>
                                
                                <div class="row g-2 mb-2">
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">Amount</div>
                                        <div style="font-weight: 600;">₹8L</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">ROI</div>
                                        <div style="font-weight: 600; color: #059669;">11.40%</div>
                                        <div style="font-size: 0.7rem; color: #10b981;">-0.10%</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">PF</div>
                                        <div style="font-weight: 600; color: #059669;">₹7.5K</div>
                                        <div style="font-size: 0.7rem; color: #10b981;">-6%</div>
                                    </div>
                                    <div class="col-3">
                                        <div style="font-size: 0.7rem; color: #6b7280;">Impact</div>
                                        <div style="font-weight: 600; color: #059669;">₹4.5K</div>
                                    </div>
                                </div>
                                
                                <div class="mb-2 mt-1 p-2" style="background-color: #f9fafb; border-radius: 4px; border-left: 3px solid #d1d5db;">
                                    <div style="font-size: 0.7rem; font-weight: 600; color: #4b5563;">RM Justification:</div>
                                    <p style="font-size: 0.75rem; color: #4b5563; margin-bottom: 0;">
                                        "Long-term loyal customer with excellent repayment history. Minor price adjustment requested."
                                    </p>
                                </div>
                                
                                <div class="card mb-2 border-0 shadow-sm">
                                    <div class="card-header py-1 px-2 bg-light d-flex justify-content-between">
                                        <span style="font-size: 0.7rem; font-weight: 600; color: #4b5563;">RM Performance</span>
                                        <span class="badge bg-info text-dark">New RM</span>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="row g-1 mb-1">
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">Deviation Rate</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">8% <span style="font-size: 0.65rem;">(-17% vs avg)</span></div>
                                            </div>
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">S2D Rate</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">85% <span style="font-size: 0.65rem;">(+12% vs avg)</span></div>
                                            </div>
                                        </div>
                                        <div class="row g-1">
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">MTD Deviations</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">3 <span style="font-size: 0.65rem;">(-10 vs avg)</span></div>
                                            </div>
                                            <div class="col-6">
                                                <div style="font-size: 0.65rem; color: #6b7280;">Avg Deviation Size</div>
                                                <div style="font-weight: 600; color: #10b981; font-size: 0.8rem;">₹12K <span style="font-size: 0.65rem;">(-72% vs avg)</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                <!-- Approver's Incentive Impact with Recommendation -->
                                <div class="card mb-2 mt-3 border-0 shadow-sm bg-light">
                                    <div class="card-body p-2">
                                        <h6 class="mb-2" style="font-size: 0.8rem; font-weight: 600; color: #1e40af;">Approver's Incentive Impact</h6>
                                        <div class="d-flex justify-content-between mb-1" style="font-size: 0.8rem;">
                                            <span>Monthly incentive impact:</span>
                                            <span class="fw-bold text-success">-₹250</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2" style="font-size: 0.8rem;">
                                            <span>Portfolio yield impact:</span>
                                            <span class="fw-bold text-success">-0.3 bps</span>
                                        </div>
                                <div id="recommendation-container-3" class="recommendation-container">
                                    <!-- Recommendation content will be dynamically updated -->
                                </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center gap-2">
                                    <button class="btn btn-sm btn-success py-2 flex-fill">
                                        <i class="fas fa-check me-1"></i> Approve
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger py-2 flex-fill">
                                        <i class="fas fa-times me-1"></i> Reject
                                    </button>
                                    <div class="dropdown flex-fill">
                                        <button class="btn btn-sm btn-outline-primary dropdown-toggle w-100 py-2" type="button" id="discussionDropdown3" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="fas fa-comments me-1"></i> Discuss
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="discussionDropdown3">
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-user-tie me-2"></i>Contact RM</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Contact Customer</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-users me-2"></i>Schedule Call</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hardcoded patterns for demo
            const patterns = {
                "high-take-up-rate": {
                    name: "High Take Up Rate - Priority Case",
                    insight: "Customer highly likely to accept the loan offer based on behavioral indicators.",
                    iconBackground: "#d1fae5",
                    iconColor: "#10b981", 
                    icon: "check-circle"
                },
                "low-take-up-rate": {
                    name: "Low Take Up Rate - Deprioritize",
                    insight: "Customer unlikely to proceed with the loan based on behavioral indicators.",
                    iconBackground: "#f3f4f6",
                    iconColor: "#9ca3af",
                    icon: "exclamation-triangle"
                },
                "strategic": {
                    name: "Strategic Relationship Case",
                    insight: "High lifetime value customers with significant relationship value across products.",
                    iconBackground: "#bfdbfe",
                    iconColor: "#1e40af",
                    icon: "handshake"
                },
                "prime": {
                    name: "Prime Customer - Conversion Critical",
                    insight: "Strong bureau, low FOIR cases that meet high quality thresholds.",
                    iconBackground: "#bbf7d0",
                    iconColor: "#166534",
                    icon: "trophy"
                },
                "micro": {
                    name: "Micro-Deviation (Low Impact)",
                    insight: "Very small ROI/PF tweaks with negligible impact on profitability.",
                    iconBackground: "#dbeafe",
                    iconColor: "#2563eb",
                    icon: "microscope"
                },
                "highrisk": {
                    name: "High Risk Case",
                    insight: "Poor risk profiles with pricing reduction requests.",
                    iconBackground: "#fee2e2",
                    iconColor: "#b91c1c",
                    icon: "radiation"
                },
                "highticket": {
                    name: "High Ticket Exposure Case",
                    insight: "Large loans with significant absolute revenue impact.",
                    iconBackground: "#fed7aa",
                    iconColor: "#9a3412",
                    icon: "money-bill-wave"
                },
                "autoreject": {
                    name: "Auto-Reject (High Risk Profile)",
                    insight: "Cases that fall in the auto-rejection zone due to risk profile.",
                    iconBackground: "#fecaca",
                    iconColor: "#991b1b",
                    icon: "ban"
                },
                "autoapprove": {
                    name: "Auto-Approve (Micro-Deviation)",
                    insight: "Low-impact cases eligible for automatic approval without manual review.",
                    iconBackground: "#a7f3d0",
                    iconColor: "#065f46",
                    icon: "check-circle"
                },
                "greyzone": {
                    name: "Grey Zone (Manual Review)",
                    insight: "Cases that require manual review due to mixed risk signals.",
                    iconBackground: "#e5e7eb",
                    iconColor: "#4b5563",
                    icon: "search"
                }
            };
            
            // Scenario case data for different patterns
            const scenarioData = {
                "high-take-up-rate": {
                    roi: "11.50%",
                    roiDiff: "-0.25%",
                    pf: "₹15K",
                    pfDiff: "-25%",
                    impact: "₹55K",
                    incentiveImpact: "-₹750",
                    portfolioYieldImpact: "-0.8 bps",
                    justification: "High probability of conversion based on ML model. Customer actively negotiating and completed all documentation steps.",
                    recommendation: "<div style=\"background-color: #dcfce7; border-left: 3px solid #10b981; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #047857;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #047857;\">Approve - ML model predicts 85% take-up probability. Portfolio can absorb -0.8 bps impact. Prioritize for same-day processing.</div></div>"
                },
                "low-take-up-rate": {
                    roi: "11.00%",
                    roiDiff: "-1.00%",
                    pf: "₹8K",
                    pfDiff: "-68%",
                    impact: "₹1.4L",
                    incentiveImpact: "-₹2,350",
                    portfolioYieldImpact: "-3.4 bps",
                    justification: "Customer showed interest but has not completed documentation despite 3 follow-ups. Mentioned shopping around for better rates.",
                    recommendation: "<div style=\"background-color: #fee2e2; border-left: 3px solid #dc2626; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #b91c1c;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #b91c1c;\">Reject - ML model predicts only 15% take-up probability. High portfolio yield impact (-3.4 bps) not justified for low conversion case. Deprioritize processing.</div></div>"
                },
                "prime": {
                    roi: "11.75%",
                    roiDiff: "-0.25%",
                    pf: "₹20K",
                    pfDiff: "-15%",
                    impact: "₹45K",
                    incentiveImpact: "-₹850",
                    portfolioYieldImpact: "-0.9 bps",
                    justification: "Prime customer with excellent bureau and income profile. Minor adjustment to close the deal quickly.",
                    recommendation: "<div style=\"background-color: #dcfce7; border-left: 3px solid #10b981; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #047857;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #047857;\">Approve - This prime customer has FOIR <30% and excellent bureau history. Portfolio can absorb the -0.9 bps impact. High conversion probability.</div></div>"
                },
                "strategic": {
                    roi: "11.40%",
                    roiDiff: "-0.60%",
                    pf: "₹18K",
                    pfDiff: "-20%",
                    impact: "₹78K",
                    incentiveImpact: "-₹1,100",
                    portfolioYieldImpact: "-1.2 bps",
                    justification: "Strategic client with significant cross-sell opportunities. Rate match needed to secure entire relationship.",
                    recommendation: "<div style=\"background-color: #fef3c7; border-left: 3px solid #d97706; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #92400e;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #92400e;\">Consider approving - Total relationship value (₹45L across 3 products) justifies -1.2 bps yield impact. Contact customer to secure commitment on wealth management portfolio.</div></div>"
                },
                "micro": {
                    roi: "11.90%",
                    roiDiff: "-0.10%",
                    pf: "₹23K",
                    pfDiff: "-5%",
                    impact: "₹12K",
                    incentiveImpact: "-₹250",
                    portfolioYieldImpact: "-0.3 bps",
                    justification: "Long-term loyal customer with excellent repayment history. Minor price adjustment requested.",
                    recommendation: "<div style=\"background-color: #dcfce7; border-left: 3px solid #10b981; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #047857;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #047857;\">Auto-approve - Negligible impact on portfolio yield (-0.3 bps). RM has disciplined deviation pattern (8% vs branch average of 25%). No direct customer call needed.</div></div>"
                },
                "highrisk": {
                    roi: "11.25%",
                    roiDiff: "-0.75%",
                    pf: "₹10K",
                    pfDiff: "-60%",
                    impact: "₹1.2L",
                    incentiveImpact: "-₹2,150",
                    portfolioYieldImpact: "-3.2 bps",
                    justification: "Customer has a competitive offer from ABC Bank at 11.00%. This is a high-value relationship customer with 3 existing products.",
                    recommendation: "<div style=\"background-color: #fee2e2; border-left: 3px solid #dc2626; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #b91c1c;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #b91c1c;\">Counter at 11.50% - Further deviation would drop branch portfolio yield below quarterly target. This RM consistently exceeds deviation thresholds (32% vs 25% avg). Verify competitor offer.</div></div>"
                },
                "highticket": {
                    roi: "11.50%",
                    roiDiff: "-0.50%",
                    pf: "₹35K",
                    pfDiff: "-30%",
                    impact: "₹1.5L",
                    incentiveImpact: "-₹1,750",
                    portfolioYieldImpact: "-2.5 bps",
                    justification: "High ticket loan for premium client. Rate adjustment needed to remain competitive in the premium segment.",
                    recommendation: "<div style=\"background-color: #fef3c7; border-left: 3px solid #d97706; padding: 6px 8px; border-radius: 4px; margin-top: 6px;\"><div style=\"font-size: 0.75rem; font-weight: 600; color: #92400e;\"><i class=\"fas fa-lightbulb me-1\"></i> Recommendation:</div><div style=\"font-size: 0.75rem; color: #92400e;\">Escalate to Credit Head - Amount exceeds your approval threshold. Absolute revenue impact (₹1.5L) is significant despite modest ROI adjustment. Recommend structuring as Piramal Premium + Regular.</div></div>"
                },
                "autoreject": {
                    roi: "11.20%",
                    roiDiff: "-0.80%",
                    pf: "₹8K",
                    pfDiff: "-68%",
                    impact: "₹1.35L",
                    incentiveImpact: "-₹2,450",
                    scorecardImpact: "-1.5 pts",
                    portfolioYieldImpact: "-3.6 bps",
                    justification: "Extreme price sensitivity. Competitor offering 11.00% with similar terms."
                },
                "autoapprove": {
                    roi: "11.95%",
                    roiDiff: "-0.05%",
                    pf: "₹24K",
                    pfDiff: "-2%",
                    impact: "₹7K",
                    incentiveImpact: "-₹100",
                    scorecardImpact: "-0.05 pts",
                    portfolioYieldImpact: "-0.1 bps",
                    justification: "Minimal deviation for highest-rated customer. Long relationship history with perfect repayments."
                },
                "greyzone": {
                    roi: "11.55%",
                    roiDiff: "-0.45%",
                    pf: "₹17K",
                    pfDiff: "-32%",
                    impact: "₹76K",
                    incentiveImpact: "-₹980",
                    scorecardImpact: "-0.45 pts",
                    portfolioYieldImpact: "-1.3 bps",
                    justification: "Mixed signals - strong bureau but price sensitive. Deviation needed to improve conversion likelihood."
                }
            };
            
            // Direct function to update all recommendations
            function updateAllRecommendations(selectedPatternId) {
                console.log("Updating ALL recommendations for scenario:", selectedPatternId);
                
                // Get all recommendation containers
                const containers = document.querySelectorAll('.recommendation-container');
                
                // Define recommendation content and styles for each scenario
                let bgColor, borderColor, textColor, content;
                
                switch(selectedPatternId) {
                    case 'high-take-up-rate':
                        bgColor = "#dcfce7";
                        borderColor = "#10b981";
                        textColor = "#047857";
                        content = "Approve - ML model predicts 85% take-up probability. Portfolio can absorb -0.8 bps impact. Prioritize for same-day processing.";
                        break;
                    case 'low-take-up-rate':
                        bgColor = "#fee2e2";
                        borderColor = "#dc2626";
                        textColor = "#b91c1c";
                        content = "Reject - ML model predicts only 15% take-up probability. High portfolio yield impact (-3.4 bps) not justified for low conversion case. Deprioritize processing.";
                        break;
                    case 'prime':
                        bgColor = "#dcfce7";
                        borderColor = "#10b981";
                        textColor = "#047857";
                        content = "Approve - This prime customer has FOIR <30% and excellent bureau history. Portfolio can absorb the -0.9 bps impact. High conversion probability.";
                        break;
                    case 'strategic':
                        bgColor = "#fef3c7";
                        borderColor = "#d97706";
                        textColor = "#92400e";
                        content = "Consider approving - Total relationship value (₹45L across 3 products) justifies -1.2 bps yield impact. Contact customer to secure commitment on wealth management portfolio.";
                        break;
                    case 'micro':
                        bgColor = "#dcfce7";
                        borderColor = "#10b981";
                        textColor = "#047857";
                        content = "Auto-approve - Negligible impact on portfolio yield (-0.3 bps). RM has disciplined deviation pattern (8% vs branch average of 25%). No direct customer call needed.";
                        break;
                    case 'highrisk':
                        bgColor = "#fee2e2";
                        borderColor = "#dc2626";
                        textColor = "#b91c1c";
                        content = "Counter at 11.50% - Further deviation would drop branch portfolio yield below quarterly target. This RM consistently exceeds deviation thresholds (32% vs 25% avg). Verify competitor offer.";
                        break;
                    case 'highticket':
                        bgColor = "#fef3c7";
                        borderColor = "#d97706";
                        textColor = "#92400e";
                        content = "Escalate to Credit Head - Amount exceeds your approval threshold. Absolute revenue impact (₹1.5L) is significant despite modest ROI adjustment. Recommend structuring as Piramal Premium + Regular.";
                        break;
                    case 'autoapprove':
                        bgColor = "#dcfce7";
                        borderColor = "#10b981";
                        textColor = "#047857";
                        content = "Auto-approve - System confirms this case meets auto-approval criteria. Deviation is minimal with no material impact on portfolio metrics. No manual review required.";
                        break;
                    case 'greyzone':
                        bgColor = "#e0f2fe";
                        borderColor = "#0284c7";
                        textColor = "#075985";
                        content = "Review required - Case falls in the grey zone with mixed signals. Request verification of competitor offer and compare to similar recently approved cases.";
                        break;
                    case 'autoreject':
                        bgColor = "#fee2e2";
                        borderColor = "#dc2626";
                        textColor = "#b91c1c";
                        content = "Auto-reject - Deviation exceeds policy thresholds significantly. L3+ approval required if you wish to proceed. Consider counter-offer at 11.65% which stays within acceptable limits.";
                        break;
                    default:
                        bgColor = "#dcfce7";
                        borderColor = "#10b981";
                        textColor = "#047857";
                        content = "Please select a scenario to see a recommendation.";
                }
                
                // Update all recommendation containers with the same content
                const recommendationHTML = `
                    <div style="background-color: ${bgColor}; border-left: 3px solid ${borderColor}; padding: 6px 8px; border-radius: 4px; margin-top: 6px;">
                        <div style="font-size: 0.75rem; font-weight: 600; color: ${textColor};"><i class="fas fa-lightbulb me-1"></i> Recommendation:</div>
                        <div style="font-size: 0.75rem; color: ${textColor};">${content}</div>
                    </div>
                `;
                
                containers.forEach((container, index) => {
                    container.innerHTML = recommendationHTML;
                    console.log(`Updated recommendation container ${index+1} for scenario: ${selectedPatternId}`);
                });
            }
            
            // Set up event listener for scenario selection
            document.getElementById('scenario-selector').addEventListener('change', function() {
                const selectedPatternId = this.value;
                
                // Hide or show portfolio nudge layer based on selection
                if (selectedPatternId === '') {
                    document.getElementById('portfolio-nudge').style.display = 'block';
                    document.getElementById('primary-pattern-section').style.display = 'none';
                } else {
                    document.getElementById('portfolio-nudge').style.display = 'none';
                    document.getElementById('primary-pattern-section').style.display = 'block';
                    
                    // Update pattern display
                    const selectedPattern = patterns[selectedPatternId];
                    if (selectedPattern) {
                        document.getElementById('pattern-name').textContent = selectedPattern.name;
                        
                        // Create and display the badge
                        const badgeContainer = document.getElementById('pattern-badge-container');
                        badgeContainer.innerHTML = '';
                        const badge = document.createElement('div');
                        badge.className = 'scenario-badge';
                        badge.style.backgroundColor = selectedPattern.iconBackground;
                        badge.style.color = selectedPattern.iconColor;
                        badge.innerHTML = `<i class="fas fa-${selectedPattern.icon} me-1"></i> ${selectedPattern.name}`;
                        badgeContainer.appendChild(badge);
                        
                        // Update insight message
                        document.getElementById('pattern-insight').innerHTML = `<div class="small mt-1" style="font-size: 0.75rem;">${selectedPattern.insight}</div>`;
                        
                        // Update case values based on selected scenario
                        const scenarioValues = scenarioData[selectedPatternId];
                        if (scenarioValues) {
                            // Update active case details
                            const activeCase = document.querySelector('.case-item.active');
                            
                            // Update ROI
                            const roiValue = activeCase.querySelector('.col-3:nth-child(2) div:nth-child(2)');
                            const roiDiff = activeCase.querySelector('.col-3:nth-child(2) div:nth-child(3)');
                            if (roiValue && roiDiff) {
                                roiValue.textContent = scenarioValues.roi;
                                roiDiff.textContent = scenarioValues.roiDiff;
                            }
                            
                            // Update PF
                            const pfValue = activeCase.querySelector('.col-3:nth-child(3) div:nth-child(2)');
                            const pfDiff = activeCase.querySelector('.col-3:nth-child(3) div:nth-child(3)');
                            if (pfValue && pfDiff) {
                                pfValue.textContent = scenarioValues.pf;
                                pfDiff.textContent = scenarioValues.pfDiff;
                            }
                            
                            // Update Impact
                            const impactValue = activeCase.querySelector('.col-3:nth-child(4) div:nth-child(2)');
                            if (impactValue) {
                                impactValue.textContent = scenarioValues.impact;
                            }
                            
                            // Update RM Justification
                            const justificationText = activeCase.querySelector('.mb-2.mt-1.p-2 p');
                            if (justificationText) {
                                justificationText.textContent = `"${scenarioValues.justification}"`;
                            }
                            
                                // Update Approver's Incentive Impact
                            const monthlyImpact = activeCase.querySelector('.card-body.p-2 .d-flex.justify-content-between.mb-1:first-child span:nth-child(2)');
                            const portfolioYieldImpact = activeCase.querySelector('.card-body.p-2 .d-flex.justify-content-between.mb-2 span:nth-child(2)');
                            
                            if (monthlyImpact && portfolioYieldImpact) {
                                monthlyImpact.textContent = scenarioValues.incentiveImpact;
                                portfolioYieldImpact.textContent = scenarioValues.portfolioYieldImpact;
                                
                                // Update color based on impact severity
                                const impactValue = parseFloat(scenarioValues.incentiveImpact.replace('-₹', '').replace(',', ''));
                                
                                if (impactValue > 1500) {
                                    monthlyImpact.className = 'fw-bold text-danger';
                                    portfolioYieldImpact.className = 'fw-bold text-danger';
                                } else if (impactValue > 500) {
                                    monthlyImpact.className = 'fw-bold text-warning';
                                    portfolioYieldImpact.className = 'fw-bold text-warning';
                                } else {
                                    monthlyImpact.className = 'fw-bold text-success';
                                    portfolioYieldImpact.className = 'fw-bold text-success';
                                }
                                
                                // Update all recommendations
                                updateAllRecommendations(selectedPatternId);
                            }
                        }
                    }
                }
            });
            
            // Set up the approval-scenario filter
            document.getElementById('approval-scenario').addEventListener('change', function() {
                const selectedCaseType = this.value;
                const cases = document.querySelectorAll('.case-item');
                let matchedCase = null;
                
                cases.forEach(caseItem => {
                    const badges = caseItem.querySelectorAll('.badge');
                    let match = false;
                    
                    if (selectedCaseType === 'all') {
                        // For "all", just show the first case
                        if (matchedCase === null) {
                            match = true;
                        }
                    } else {
                        badges.forEach(badge => {
                            const badgeText = badge.textContent.toLowerCase();
                            if ((selectedCaseType === 'high' && badgeText.includes('high')) ||
                                (selectedCaseType === 'medium' && badgeText.includes('medium')) ||
                                (selectedCaseType === 'low' && badgeText.includes('low')) ||
                                (selectedCaseType === 'microdev' && badgeText.includes('micro')) ||
                                (selectedCaseType === 'strategic' && badgeText.includes('strategic')) ||
                                (selectedCaseType === 'competitive' && badgeText.includes('competitive'))) {
                                match = true;
                            }
                        });
                    }
                    
                    if (match && matchedCase === null) {
                        matchedCase = caseItem;
                    }
                    
                    // Hide all cases initially
                    caseItem.classList.remove('active');
                });
                
                // Show matched case if found
                if (matchedCase) {
                    matchedCase.classList.add('active');
                } else {
                    // If no match found, show the first case as a fallback
                    const firstCase = document.querySelector('.case-item');
                    if (firstCase) {
                        firstCase.classList.add('active');
                    }
                }
            });
            
            // Function to force update UI with current scenario
            function forceUpdateUI() {
                const currentScenario = document.getElementById('scenario-selector').value;
                console.log("Force updating UI for scenario:", currentScenario);
                
                // Call our recommendation update function directly
                updateAllRecommendations(currentScenario);
                
                // Then dispatch the change event to update other UI elements
                document.getElementById('scenario-selector').dispatchEvent(new Event('change'));
            }
            
            // Initialize scenario to prime and update UI
            document.getElementById('scenario-selector').value = 'prime';
            forceUpdateUI();
            
            // Add a button click handler for when cases change
            document.querySelectorAll('.case-item').forEach(item => {
                const caseIndex = item.getAttribute('data-case-index');
                console.log(`Added handler for case ${caseIndex}`);
            });
            
            // Initialize to show the first case
            const allCases = document.querySelectorAll('.case-item');
            allCases.forEach((caseItem, index) => {
                if (index === 0) {
                    caseItem.classList.add('active');
                } else {
                    caseItem.classList.remove('active');
                }
                
                // Add a mutation observer to detect when cases become active
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && 
                            mutation.attributeName === 'class' && 
                            caseItem.classList.contains('active')) {
                            console.log(`Case ${caseItem.getAttribute('data-case-index')} became active`);
                            forceUpdateUI();
                        }
                    });
                });
                
                // Start observing
                observer.observe(caseItem, { attributes: true });
            });
            
            // Add a direct event listener to the scenario selector
            document.getElementById('scenario-selector').addEventListener('input', function() {
                console.log("INPUT EVENT: Scenario changed to " + this.value);
                updateAllRecommendations(this.value);
            });
            
            // Force an initial update and set a delayed update
            forceUpdateUI();
            setTimeout(updateAllRecommendations, 500, document.getElementById('scenario-selector').value);
            setTimeout(forceUpdateUI, 1000);
        });
    </script>
</body>
</html>
